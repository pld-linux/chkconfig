--- chkconfig-1.2.16/chkconfig.c.wiget	Thu Jul 13 21:42:54 2000
+++ chkconfig-1.2.16/chkconfig.c	Wed Nov 29 12:31:44 2000
@@ -12,6 +12,7 @@
 #include <unistd.h>
 
 static char *progname;
+extern int addItem;
 
 #define _(String) gettext((String)) 
 
@@ -75,12 +76,10 @@
     if (s.type == TYPE_XINETD) return 0;
     
     for (i = 0; i < 7; i++) {
-	if (!isConfigured(name, i)) {
 	    if ((1 << i) & s.levels)
 		doSetService(s, i, 1);
 	    else
 		doSetService(s, i, 0);
-	}
     }
 
     return 0;
--- chkconfig-1.2.16/leveldb.c.wiget	Wed Aug 30 23:35:52 2000
+++ chkconfig-1.2.16/leveldb.c	Wed Nov 29 12:40:20 2000
@@ -11,6 +11,10 @@
 #include <stdio.h>
 #include <string.h>
 #include <unistd.h>
+#include <sys/types.h>
+#include <dirent.h>
+
+int addItem = 0;
 
 /* Changes
    1998-09-22 - Arnaldo Carvalho de Melo <acme@conectiva.com.br>
@@ -225,6 +229,9 @@
     char overflow;
     char levelbuf[20];
     char * english_desc = NULL;
+    DIR *dir;
+    struct dirent *dirent;
+    int i;
 
     sprintf(filename, RUNLEVELS "/init.d/%s", name);
 
@@ -316,6 +322,21 @@
     } 
 
     serv.name = strdup(name);
+
+    if (addItem) {
+      strcpy(levelbuf,"/etc/rc.d/rc0.d");
+      for(i=0;i<7;i++,levelbuf[12]++) {
+	dir=opendir(levelbuf);
+	if (!dir) return 1;
+	while ((dirent=readdir(dir))) {
+	  if (strlen(dirent->d_name)<4) continue;
+	  if (strcmp(dirent->d_name+3,name)) continue;
+	  if (*dirent->d_name=='K') serv.levels &= ~(1<<i);
+	  else if (*dirent->d_name=='S') serv.levels |= 1<<i;
+	}
+	closedir(dir);
+      }
+    }
 
     *service = serv;
     return 0;
